@page "/"
@using Ava.Data
@using Ava.Data.Statistics
@using Ava.Interfaces
@using Ava.Services
@using Microsoft.AspNetCore.Identity
@inherits Ava.Components.Bases.LayoutBase
@inject IGameStatsService GameStatsService
@inject UserManager<ApplicationUser> UserManager
<PageTitle>Home</PageTitle>

@if (CurrentUser == null)
{
    <div class="w-4/5 mx-auto grid grid-cols-1 gap-4 mb-2">
        <div class="col-span-full">
            <section class="bg-white dark:bg-gray-900">
                <div class="py-4 px-2 mx-auto max-w-screen-xl text-center lg:py-8 lg:px-6">
                    <a href="#" class="inline-flex justify-between items-center py-1 px-1 pr-4 mb-7 text-sm text-gray-700 bg-gray-100 rounded-full dark:bg-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-700" role="alert">
                        <span class="text-xs bg-primary-600 rounded-full text-white px-4 py-1.5 mr-3">New</span> <span class="text-sm font-medium">Demo is ready! Check it out...</span>
                        <svg class="ml-2 w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg>
                    </a>
                    <h3 class="mb-4 text-2xl font-extrabold tracking-tight leading-none text-gray-900 md:text-5xl lg:text-6xl dark:text-white">Hey There, Stranger!</h3>
                    <p class="mb-8 text-lg font-normal text-gray-500 lg:text-xl sm:px-16 xl:px-48 dark:text-gray-400">
                        Welcome to my corner of the internet. If you’re reading this, you either took a wrong turn on the web or you’re genuinely curious about the man, the myth, the legend—me, Richard Weiser.
                        But let’s be real, I’m more like a quirky legend with a knack for accidentally breaking things... and then heroically fixing them. About me below will take you to my LinkedIn Profile, The 'Heatstroke' video is a simply for bragging about my daughter and the sport of marksmanship.
                    </p>
                    <div class="flex flex-col mb-8 lg:mb-16 space-y-4 sm:flex-row sm:justify-center sm:space-y-0 sm:space-x-4">
                        <a href="https://www.linkedin.com/in/richweiser/" target="_blank" class="inline-flex justify-center items-center py-3 px-5 text-base font-medium text-center text-white rounded-lg bg-primary-700 hover:bg-primary-800 focus:ring-4 focus:ring-primary-300 dark:focus:ring-primary-900">
                            About Me
                            <svg class="ml-2 -mr-1 w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                        </a>
                        <a href="https://www.youtube.com/watch?v=L6POMBQRnQ0" target="_blank" class="inline-flex justify-center items-center py-3 px-5 text-base font-medium text-center text-gray-900 rounded-lg border border-gray-300 hover:bg-gray-100 focus:ring-4 focus:ring-gray-100 dark:text-white dark:border-gray-700 dark:hover:bg-gray-700 dark:focus:ring-gray-800">
                            <svg class="mr-2 -ml-1 w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"></path></svg>
                            Watch 'Heatsroke' Video
                        </a>
                    </div>
                </div>
            </section>
        </div>
    </div>
    <div class="w-4/5 mx-auto grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-4">
        <div class="bg-white dark:bg-gray-900 col-span-1 p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300">
            <div class="flex justify-center items-center mb-4">
                <img src="https://via.placeholder.com/100" alt="Placeholder Image" class="rounded-full shadow-md">
            </div>
            <h3 class="text-2xl font-extrabold tracking-tight leading-none text-primary dark:text-white">My Magnum Opus: WeiserTek</h3>
            <p class="text-lg font-normal text-gray-500 dark:text-gray-400 mt-2">
                For 17 years, I was the brains behind WeiserTek, a managed services provider. I wore many hats here—CTO, Chief Software Architect, and occasionally, the guy who makes coffee. We developed everything from patient encounter applications to IoT solutions. It was like being in a long-term relationship with technology, complete with the occasional argument and make-up session.
            </p>
        </div>
        <div class="bg-white dark:bg-gray-900 col-span-1 p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300">
            <div class="flex justify-center items-center mb-4">
                <img src="https://via.placeholder.com/100" alt="Placeholder Image" class="rounded-full shadow-md">
            </div>
            <h3 class="text-2xl font-extrabold tracking-tight leading-none text-primary dark:text-white">Air Rifle Coaching: From Zero to Hero</h3>
            <p class="text-lg font-normal text-gray-500 dark:text-gray-400 mt-2">
                In my first year as head coach of the Reagan Raiders Air Force JROTC Rifle Team, we didn’t just participate—we conquered. Winning the US Air Force JROTC National Championship was like taking the Carolina Panthers to the Super Bowl, minus the overpaid athletes and exorbitant ticket prices. As an NRA Certified Rifle Instructor, I’ve trained marksmen to hit their targets while barely managing to keep my own sanity intact.
            </p>
        </div>
        <div class="bg-white dark:bg-gray-900 col-span-1 p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300">
            <div class="flex justify-center items-center mb-4">
                <img src="https://via.placeholder.com/100" alt="Placeholder Image" class="rounded-full shadow-md">
            </div>
            <h3 class="text-2xl font-extrabold tracking-tight leading-none text-primary dark:text-white">The Lighter Side</h3>
            <p class="text-lg font-normal text-gray-500 dark:text-gray-400 mt-2">
                When I’m not drowning in code or coaching future sharpshooters, I enjoy long walks on the beach (of servers), romantic candlelit dinners (with my laptop), and binge-watching sci-fi movies with my family. If you see me in public, feel free to ask for an autograph or a debugging tip—both are equally valuable.
            </p>
        </div>
        <div class="bg-white dark:bg-gray-900 col-span-1 p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300">
            <div class="flex justify-center items-center mb-4">
                <img src="https://via.placeholder.com/100" alt="Placeholder Image" class="rounded-full shadow-md">
            </div>
            <h3 class="text-2xl font-extrabold tracking-tight leading-none text-primary dark:text-white">In Conclusion</h3>
            <p class="text-lg font-normal text-gray-500 dark:text-gray-400 mt-2">
                So, there you have it. A glimpse into the chaotic, humorous, and occasionally brilliant world of Richard Weiser. Stick around, log in if you dare, and join me on this wild ride. And remember, no matter how complicated life gets, there's always a solution—usually found after a few lines of code and a lot of coffee.
            </p>
        </div>
    </div>

}
@if (CurrentUser != null && (mostEasiestOpponent != default || mostFrequentOpponent != default || mostDifficultOpponent != default))
{
    <div class="w-4/5 mx-auto grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
        <div class="lg:col-span-3">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                <div class="flex justify-center items-center w-full">
                    <div class="p-4 w-full bg-gray-800 dark:bg-white rounded-lg shadow-md text-center">
                        <div class="flex justify-center items-center mb-4">
                            <div class="text-white dark:text-primary">
                                <svg class="w-6 h-6" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                    <path fill-rule="evenodd" d="M8.6 5.2A1 1 0 0 0 7 6v12a1 1 0 0 0 1.6.8l8-6a1 1 0 0 0 0-1.6l-8-6Z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div class="ml-6 text-lg font-semibold text-white dark:text-gray-900">
                                Games
                            </div>
                        </div>
                        <div class="mt-2 text-5xl font-extrabold text-white dark:text-primary">
                            @totalGamesPlayed
                        </div>
                    </div>
                </div>
                <div class="flex justify-center items-center w-full">
                    <div class="p-4 w-full bg-gray-800 dark:bg-white rounded-lg shadow-md text-center">
                        <div class="flex justify-center items-center mb-4">
                            <div class="text-white dark:text-primary">
                                <svg class="w-6 h-6" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m7.171 12.906-2.153 6.411 2.672-.89 1.568 2.34 1.825-5.183m5.73-2.678 2.154 6.411-2.673-.89-1.568 2.34-1.825-5.183M9.165 4.3c.58.068 1.153-.17 1.515-.628a1.681 1.681 0 0 1 2.64 0 1.68 1.68 0 0 0 1.515.628 1.681 1.681 0 0 1 1.866 1.866c-.068.58.17 1.154.628 1.516a1.681 1.681 0 0 1 0 2.639 1.682 1.682 0 0 0-.628 1.515 1.681 1.681 0 0 1-1.866 1.866 1.681 1.681 0 0 0-1.516.628 1.681 1.681 0 0 1-2.639 0 1.681 1.681 0 0 0-1.515-.628 1.681 1.681 0 0 1-1.867-1.866 1.681 1.681 0 0 0-.627-1.515 1.681 1.681 0 0 1 0-2.64c.458-.361.696-.935.627-1.515A1.681 1.681 0 0 1 9.165 4.3ZM14 9a2 2 0 1 1-4 0 2 2 0 0 1 4 0Z"/>
                                </svg>
                            </div>
                            <div class="ml-6 text-lg font-semibold text-white dark:text-gray-900">
                                Wins
                            </div>
                        </div>
                        <div class="mt-2 text-5xl font-extrabold text-white dark:text-primary">
                            @totalWins
                        </div>
                    </div>
                </div>
                <div class="flex justify-center items-center w-full">
                    <div class="p-4 w-full bg-gray-800 dark:bg-white rounded-lg shadow-md text-center">
                        <div class="flex justify-center items-center mb-4">
                            <div class="text-white dark:text-primary">
                                <svg class="w-6 h-6" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                    <path fill-rule="evenodd" d="M8.586 2.586A2 2 0 0 1 10 2h4a2 2 0 0 1 2 2v2h3a1 1 0 1 1 0 2v12a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V8a1 1 0 0 1 0-2h3V4a2 2 0 0 1 .586-1.414ZM10 6h4V4h-4v2Zm1 4a1 1 0 1 0-2 0v8a1 1 0 1 0 2 0v-8Zm4 0a1 1 0 1 0-2 0v8a1 1 0 1 0 2 0v-8Z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div class="ml-6 text-lg font-semibold text-white dark:text-gray-900">
                                Losses
                            </div>
                        </div>
                        <div class="mt-2 text-5xl font-extrabold text-white dark:text-primary">
                            @totalLosses
                        </div>
                    </div>
                </div>
                <div class="flex justify-center items-center w-full">
                    <div class="p-4 w-full bg-gray-800 dark:bg-white rounded-lg shadow-md text-center">
                        <div class="flex justify-center items-center mb-4">
                            <div class="text-white dark:text-primary">
                                <svg class="w-6 h-6" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                    <path fill-rule="evenodd" d="M20.29 8.567c.133.323.334.613.59.85v.002a3.536 3.536 0 0 1 0 5.166 2.442 2.442 0 0 0-.776 1.868 3.534 3.534 0 0 1-3.651 3.653 2.483 2.483 0 0 0-1.87.776 3.537 3.537 0 0 1-5.164 0 2.44 2.44 0 0 0-1.87-.776 3.533 3.533 0 0 1-3.653-3.654 2.44 2.44 0 0 0-.775-1.868 3.537 3.537 0 0 1 0-5.166 2.44 2.44 0 0 0 .775-1.87 3.55 3.55 0 0 1 1.033-2.62 3.594 3.594 0 0 1 2.62-1.032 2.401 2.401 0 0 0 1.87-.775 3.535 3.535 0 0 1 5.165 0 2.444 2.444 0 0 0 1.869.775 3.532 3.532 0 0 1 3.652 3.652c-.012.35.051.697.184 1.02ZM9.927 7.371a1 1 0 1 0 0 2h.01a1 1 0 0 0 0-2h-.01Zm5.889 2.226a1 1 0 0 0-1.414-1.415L8.184 14.4a1 1 0 0 0 1.414 1.414l6.218-6.217Zm-2.79 5.028a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2h-.01Z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div class="ml-6 text-lg font-semibold text-white dark:text-gray-900">
                                Win %
                            </div>
                        </div>
                        <div class="mt-2 text-5xl font-extrabold text-white dark:text-primary">
                            @winPercentage
                        </div>
                    </div>
                </div>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="flex justify-center items-center w-full h-full">
                    <a href="User/@mostFrequentOpponent?.Opponent.Id" class="flex flex-col items-center bg-blue-500 dark:bg-blue-700 border border-gray-200 rounded-lg shadow md:flex-row w-full h-full hover:bg-blue-700 hover:text-white dark:border-gray-700 dark:bg-gray-800 dark:hover:bg-primary dark:text-white">
                        <img class="object-cover w-full rounded-t-lg h-36 md:rounded-none md:rounded-l-lg" src="images/avatars/@mostFrequentOpponent?.Opponent.ProfilePictureUrl" alt="@mostFrequentOpponent?.Opponent.DisplayName">
                        <div class="flex flex-col justify-between p-4 leading-normal w-full h-full">
                            <div class="mb-2 tracking-tight text-white dark:text-white truncate">@mostFrequentOpponent?.Opponent.DisplayName</div>
                            <div class="font-normal text-white dark:text-gray-400 text-md">@mostFrequentOpponent?.Wins (W) | @mostFrequentOpponent?.Losses (L)</div>
                            <div class="text-white text-lg">@mostFrequentOpponent?.Percentage%</div>
                            <div class="text-white dark:text-primary text-sm">@TimeHelper.GetLastPlayedText(mostFrequentOpponent?.LastPlayed)</div>
                        </div>
                    </a>
                </div>
                <div class="flex justify-center items-center w-full h-full">
                    <a href="User/@mostDifficultOpponent?.Opponent.Id" class="flex flex-col items-center bg-red-500 dark:bg-red-700 border border-gray-200 rounded-lg shadow md:flex-row w-full h-full hover:bg-red-700 hover:text-white dark:border-gray-700 dark:bg-gray-800 dark:hover:bg-primary dark:text-white">
                        <img class="object-cover w-full rounded-t-lg h-36 md:rounded-none md:rounded-l-lg" src="images/avatars/@mostDifficultOpponent?.Opponent.ProfilePictureUrl" alt="@mostDifficultOpponent?.Opponent.DisplayName">
                        <div class="flex flex-col justify-between p-4 leading-normal w-full h-full">
                            <div class="mb-2 tracking-tight text-white dark:text-white truncate">@mostDifficultOpponent?.Opponent.DisplayName</div>
                            <div class="font-normal text-white dark:text-gray-400">@mostDifficultOpponent?.Wins (W) | @mostDifficultOpponent?.Losses (L)</div>
                            <div class="text-white text-lg">@mostDifficultOpponent?.Percentage%</div>
                            <div class="text-white dark:text-primary text-sm">@TimeHelper.GetLastPlayedText(mostDifficultOpponent?.LastPlayed)</div>
                        </div>
                    </a>
                </div>
                <div class="flex justify-center items-center w-full h-full">
                    <a href="User/@mostEasiestOpponent?.Opponent.Id" class="flex flex-col items-center bg-green-500 dark:bg-green-700 border border-gray-200 rounded-lg shadow md:flex-row w-full h-full hover:bg-green-700 hover:text-white dark:border-gray-700 dark:bg-gray-800 dark:hover:bg-primary dark:text-white">
                        <img class="object-cover w-full rounded-t-lg h-36 md:rounded-none md:rounded-l-lg" src="images/avatars/@mostEasiestOpponent?.Opponent.ProfilePictureUrl" alt="@mostEasiestOpponent?.Opponent.DisplayName">
                        <div class="flex flex-col justify-between p-4 leading-normal w-full h-full">
                            <div class="mb-2 tracking-tight text-white dark:text-white truncate">@mostEasiestOpponent?.Opponent.DisplayName</div>
                            <div class="font-normal text-white dark:text-gray-400">@mostEasiestOpponent?.Wins (W) | @mostEasiestOpponent?.Losses (L)</div>
                            <div class="text-white text-lg">@mostEasiestOpponent?.Percentage%</div>
                            <div class="text-white dark:text-primary text-sm">@TimeHelper.GetLastPlayedText(mostEasiestOpponent?.LastPlayed)</div>
                        </div>
                    </a>
                </div>
            </div>
        </div>
        <div>
            <FriendsList/>
        </div>
    </div>
}
@code {
    private int totalGamesPlayed = 0;
    private int totalWins = 0;
    private int totalLosses = 0;
    private double winPercentage = 0.0;
    private OpponentStats mostFrequentOpponent = default;
    private OpponentStats mostEasiestOpponent = default;
    private OpponentStats mostDifficultOpponent = default;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        if (CurrentUser != null)
        {
            await LoadUserStatsAsync(CurrentUser.Id);
        }
    }

    private async Task LoadUserStatsAsync(string userId)
    {
        totalGamesPlayed = await GameStatsService.GetTotalGamesPlayedAsync(userId);
        totalWins = await GameStatsService.GetTotalWinsAsync(userId);
        totalLosses = await GameStatsService.GetTotalLossesAsync(userId);

        // Calculate the win percentage
        if (totalGamesPlayed > 0)
        {
            winPercentage = Math.Round((double)totalWins / totalGamesPlayed * 100, 2);
        }

        mostFrequentOpponent = await GameStatsService.GetMostFrequentOpponentAsync(userId);
        mostEasiestOpponent = await GameStatsService.GetEasiestOpponentAsync(userId);
        mostDifficultOpponent = await GameStatsService.GetMostDifficultOpponentAsync(userId);
    }
}
